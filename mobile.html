<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>How Much Will DOGE Save You?</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
  <style>
    .tax-box {
      background: #ffffff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      margin-bottom: 15px;
    }
    .breakdown-table {
      font-size: 1rem;
      width: 100%;
      margin-bottom: 10px;
    }
    .breakdown-table th, .breakdown-table td {
      padding: 8px 6px;
      text-align: left;
      white-space: nowrap;
    }
    .breakdown-table th {
      background-color: #f0f0f0;
      font-size: 0.875rem;
    }
    .current-cell {
      background-color: #f9f9f9;
    }
    .new-cell {
      background-color: #f9f9f9;
    }
    .bg-light-blue {
      background-color: #f9f9f9;
      color: #1a2027;
    }
    .bg-selected-blue {
      background-color: #007bff;
      color: #ffffff;
    }
    .savings-cell {
      background-color: #d0eaff;
      font-weight: bold;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 50;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.5);
    }
    .modal-content {
      background-color: #fefefe;
      margin: 15% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 90%;
      max-width: 600px;
      border-radius: 8px;
    }
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }
    .sticky-summary {
      position: sticky;
      bottom: 0;
      z-index: 10;
    }
  </style>
</head>
<body class="bg-gray-50">
  <div class="max-w-lg mx-auto p-4 space-y-4">
    <!-- Header -->
    <h1 class="text-xl font-bold text-center mb-4">How Much Will DOGE Save You?</h1>

    <!-- Tax Cut Options -->
    <div class="bg-white rounded-lg shadow p-4">
      <h2 class="text-lg font-bold mb-3">Federal Spending Cut</h2>
      <div class="grid grid-cols-3 gap-2">
        <button onclick="setTaxCut(20)" id="btn20" class="bg-light-blue text-dark-blue px-2 py-3 rounded-lg text-lg font-bold">$20B</button>
        <button onclick="setTaxCut(100)" id="btn100" class="bg-selected-blue text-white px-2 py-3 rounded-lg text-lg font-bold">$100B</button>
        <button onclick="setTaxCut(1000)" id="btn1000" class="bg-light-blue text-dark-blue px-2 py-3 rounded-lg text-lg font-bold">$1T</button>
      </div>
      <input type="hidden" id="taxCut" value="100">
    </div>

    <!-- Input Fields -->
    <div class="bg-white rounded-lg shadow p-4">
      <div class="space-y-3">
        <div>
          <label class="block text-sm font-medium mb-1">Marital Status:</label>
          <select id="maritalStatus" class="w-full p-2 border rounded text-lg" oninput="calculateTaxes()">
            <option value="single">Single</option>
            <option value="married" selected>Married (Jointly)</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Income ($):</label>
          <input type="text" id="income" value="100,000" class="w-full p-2 border rounded text-lg" oninput="formatAndCalculate()">
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Tax Reduction:</label>
          <select id="taxReduction" class="w-full p-2 border rounded text-lg" oninput="calculateTaxes()">
            <option value="all" selected>All Brackets</option>
            <option value="top4">Top 4 Brackets</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Sticky Tax Summary -->
    <div class="sticky-summary bg-white shadow-lg rounded-t-lg p-4 border-t">
      <div class="grid grid-cols-3 gap-2 text-center">
        <div class="p-2 rounded current-cell">
          <div class="text-sm font-medium mb-1">Current Tax</div>
          <div id="currentTax" class="text-lg"></div>
        </div>
        <div class="p-2 rounded new-cell">
          <div class="text-sm font-medium mb-1">New Tax</div>
          <div id="newTax" class="text-lg"></div>
        </div>
        <div class="p-2 rounded savings-cell">
          <div class="text-sm font-medium mb-1">Savings</div>
          <div id="savings" class="text-lg"></div>
        </div>
      </div>
    </div>

    <!-- Tax Breakdown -->
    <div class="bg-white rounded-lg shadow p-4 overflow-x-auto">
      <h2 class="text-lg font-bold mb-3">Tax Breakdown</h2>
      <div id="breakdownTable"></div>
    </div>

    <!-- Footer -->
    <footer class="text-center text-sm pb-20">
      <button id="infoBtn" class="text-blue-500 hover:underline">Learn More</button>
      <span class="mx-2">|</span>
      <a href="https://github.com/pbrunelle/doge-tax-cuts" target="_blank" class="text-black hover:underline">
        GitHub
      </a>
      <div class="mt-2">Pierre Brunelle</div>
    </footer>
  </div>

  <!-- Modal -->
  <div id="infoModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2 class="text-lg font-bold mb-4">Information</h2>
      <div class="space-y-4 text-sm">
        <section>
          <h3 class="font-bold mb-2">Computations</h3>
          <ul class="list-disc pl-5">
            <li>2025 tax brackets are used</li>
            <li>Exemptions and deductions not modeled</li>
          </ul>
        </section>
        <section>
          <h3 class="font-bold mb-2">Assumptions</h3>
          <ul class="list-disc pl-5">
            <li>All savings passed as income tax cuts</li>
            <li>1% all-bracket reduction costs $111.3B</li>
            <li>2% top-4-bracket reduction costs $57.3B</li>
          </ul>
        </section>
      </div>
    </div>
  </div>

  <script>
    // 2025 tax brackets - https://www.irs.gov/newsroom/irs-releases-tax-inflation-adjustments-for-tax-year-2025
    const TAX_BRACKETS = {
      single: [
        { min: 0, max: 11925, rate: 0.10 },
        { min: 11925, max: 48475, rate: 0.12 },
        { min: 48475, max: 103350, rate: 0.22 },
        { min: 103350, max: 197300, rate: 0.24 },
        { min: 197300, max: 250525, rate: 0.32 },
        { min: 250525, max: 626350, rate: 0.35 },
        { min: 626350, max: Infinity, rate: 0.37 }
      ],
      married: [
        { min: 0, max: 23850, rate: 0.10 },
        { min: 23850, max: 96950, rate: 0.12 },
        { min: 96950, max: 206700, rate: 0.22 },
        { min: 206700, max: 394600, rate: 0.24 },
        { min: 394600, max: 501050, rate: 0.32 },
        { min: 501050, max: 751600, rate: 0.35 },
        { min: 751600, max: Infinity, rate: 0.37 }
      ]
    };

    const REVENUE_REDUCTION_PER_PERCENT_ALL = 111.3;
    const REVENUE_REDUCTION_PER_PERCENT_TOP4 = 0.5 * 57.3;

    function calculateBracketTax(income, brackets) {
      let remaining = income;
      let breakdown = [];
      let index = 1;
      
      for (const bracket of brackets) {
        if (income > bracket.min) {
          const taxable = Math.min(remaining, bracket.max - bracket.min);
          const tax = taxable * bracket.rate;
          breakdown.push({
            bracket: index,
            range: `${bracket.min.toLocaleString()} - ${bracket.max === Infinity ? 'âˆž' : bracket.max.toLocaleString()}`,
            taxable,
            rate: formatRate(bracket.rate * 100),
            tax
          });
          remaining -= taxable;
          index++;
          if (remaining <= 0) break;
        }
      }
      return breakdown;
    }

    function adjustBrackets(brackets, savings, reductionType) {
      const rateReduction = reductionType === 'all' 
        ? savings / REVENUE_REDUCTION_PER_PERCENT_ALL / 100 
        : savings / REVENUE_REDUCTION_PER_PERCENT_TOP4 / 100;

      return brackets.map((b, index) => ({
        min: b.min,
        max: b.max,
        rate: reductionType === 'all' || index >= 3 ? Math.max(b.rate - rateReduction, 0) : b.rate
      }));
    }

    function formatRate(rate) {
      return rate % 1 === 0 ? `${rate}%` : `${rate.toFixed(1)}%`;
    }

    function setTaxCut(amount) {
      const buttons = document.querySelectorAll('[id^="btn"]');
      buttons.forEach(button => {
        button.classList.remove('bg-selected-blue', 'text-white');
        button.classList.add('bg-light-blue', 'text-dark-blue');
      });

      let selectedButtonId = "btn" + amount;
      const clickedButton = document.getElementById(selectedButtonId);
      if (clickedButton) {
        clickedButton.classList.remove('bg-light-blue', 'text-dark-blue');
        clickedButton.classList.add('bg-selected-blue', 'text-white');
      }

      document.getElementById('taxCut').value = amount;
      calculateTaxes();
    }

    function renderBreakdownTable(currentBreakdown, newBreakdown) {
      const table = document.getElementById('breakdownTable');
      let html = `
        <table class="breakdown-table">
          <colgroup>
            <col style="width: 50%;">
            <col style="width: 50%;">
          </colgroup>
          <thead>
            <tr>
              <th>Category</th>
              <th>Value</th>
            </tr>
          </thead>
        </table>
      `;

      let totalTaxable = 0;
      let totalCurrentTax = 0;
      let totalNewTax = 0;

      currentBreakdown.forEach((cur, i) => {
        const nw = newBreakdown[i] || {};
        totalTaxable += cur.taxable;
        totalCurrentTax += cur.tax;
        totalNewTax += nw.tax || 0;

        html += `
          <table class="breakdown-table">
            <colgroup>
              <col style="width: 50%;">
              <col style="width: 50%;">
            </colgroup>
            <tbody>
              <tr>
                <th>Bracket ${cur.bracket}</th>
                <td></td>
              </tr>
              <tr>
                <th>Range</th>
                <td>${cur.range}</td>
              </tr>
              <tr>
                <th>Taxable</th>
                <td>$${Math.round(cur.taxable).toLocaleString('en-US')}</td>
              </tr>
              <tr class="current-cell">
                <th>Rate (Current)</th>
                <td>${cur.rate}</td>
              </tr>
              <tr class="current-cell">
                <th>Tax (Current)</th>
                <td>$${Math.round(cur.tax).toLocaleString('en-US')}</td>
              </tr>
              <tr class="new-cell">
                <th>Rate (New)</th>
                <td>${nw.rate !== undefined ? formatRate(nw.rate * 100) : ''}</td>
              </tr>
              <tr class="new-cell">
                <th>Tax (New)</th>
                <td>$${Math.round(nw.tax || 0).toLocaleString('en-US')}</td>
              </tr>
            </tbody>
          </table>
        `;
      });

      html += `
        <table class="breakdown-table">
          <colgroup>
            <col style="width: 50%;">
            <col style="width: 50%;">
          </colgroup>
          <tbody>
            <tr>
              <th>Total Taxable</th>
              <td>$${Math.round(totalTaxable).toLocaleString('en-US')}</td>
            </tr>
            <tr class="current-cell">
              <th>Total Tax (Current)</th>
              <td>$${Math.round(totalCurrentTax).toLocaleString('en-US')}</td>
            </tr>
            <tr class="new-cell">
              <th>Total Tax (New)</th>
              <td>$${Math.round(totalNewTax).toLocaleString('en-US')}</td>
            </tr>
          </tbody>
        </table>
      `;

      table.innerHTML = html;
      return { totalCurrentTax, totalNewTax };
    }

    function formatAndCalculate() {
      formatIncome();
      calculateTaxes();
    }

    function formatIncome() {
      const incomeField = document.getElementById('income');
      let value = incomeField.value.replace(/,/g, '');
      if (!isNaN(value) && value !== '') {
        incomeField.value = parseFloat(value).toLocaleString('en-US');
      }
    }

    function calculateTaxes() {
      const incomeField = document.getElementById('income');
      let income = parseFloat(incomeField.value.replace(/,/g, '')) || 0;
      const maritalStatus = document.getElementById('maritalStatus').value;
      const selectedBrackets = TAX_BRACKETS[maritalStatus];
      const taxCut = parseFloat(document.getElementById('taxCut').value);
      const reductionType = document.getElementById('taxReduction').value;

      const currentBreakdown = calculateBracketTax(income, selectedBrackets);
      const newBreakdown = calculateBracketTax(income, adjustBrackets(selectedBrackets, taxCut, reductionType));
      
      const { totalCurrentTax, totalNewTax } = renderBreakdownTable(currentBreakdown, newBreakdown);

      document.getElementById('currentTax').textContent = 
        `$${Math.round(totalCurrentTax).toLocaleString('en-US')}`;
      document.getElementById('newTax').textContent = 
        `$${Math.round(totalNewTax).toLocaleString('en-US')}`;
      document.getElementById('savings').textContent = 
        `$${Math.round(totalCurrentTax - totalNewTax).toLocaleString('en-US')}`;
    }

    // Initialize calculations on page load
    window.onload = calculateTaxes;

    // Get the modal
    var modal = document.getElementById("infoModal");

    // Get the button that opens the modal
    var btn = document.getElementById("infoBtn");

    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName("close")[0];

    // When the user clicks the button, open the modal
    btn.onclick = function() {
      modal.style.display = "block";
    }

    // When the user clicks on <span> (x), close the modal
    span.onclick = function() {
      modal.style.display = "none";
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }
  </script>
</body>
</html>